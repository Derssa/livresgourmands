@startuml
' ===============================
' CLASS DIAGRAM - Online Bookstore
' ===============================

class User {
  +id : int
  +email : string
  +password_hash : string
  +first_name : string
  +last_name : string
  +role : Role
  +created_at : timestamp
}

enum Role {
  CLIENT
  ADMIN
  EDITOR
  MANAGER
}

class Category {
  +id : int
  +name : string
  +description : text
}

class Book {
  +id : int
  +title : string
  +author : string
  +isbn : string
  +price : decimal
  +stock : int
  +description : text
  +coverImage : string
  +fileUrl : string
  +publishedDate : date
}

class Order {
  +id : int
  +total : decimal
  +status : OrderStatus
  +payment_mode : string
  +is_gift : boolean
  +gift_recipient_name : string
  +gift_recipient_email : string
  +gift_message : text
  +created_at : timestamp
}

enum OrderStatus {
  PENDING
  PAID
  CANCELLED
}

class OrderItem {
  +id : int
  +quantity : int
  +price_each : decimal
}

class GiftList {
  +id : int
  +title : string
  +description : text
  +share_code : string
  +is_active : boolean
  +created_at : timestamp
}

class GiftListItem {
  +id : int
  +quantity : int
  +created_at : timestamp
}

class GiftPurchase {
  +id : int
  +quantity : int
  +purchased_at : timestamp
}

class Review {
  +id : int
  +rating : tinyint
  +created_at : timestamp
}

class Comment {
  +id : int
  +content : text
  +validated : boolean
  +created_at : timestamp
}

class UserEbook {
  +id : int
  +source : EbookSource
  +created_at : timestamp
}

enum EbookSource {
  PURCHASE
  GIFT
}

class GiftRedemption {
  +id : int
  +recipient_email : string
  +token : string
  +redeemed_at : timestamp
  +created_at : timestamp
}

' ===============================
' RELATIONSHIPS
' ===============================

User "1" -- "many" Order : places >
Order "1" -- "many" OrderItem : contains >
OrderItem "many" -- "1" Book : references >

User "1" -- "many" GiftList : owns >
GiftList "1" -- "many" GiftListItem : includes >
GiftListItem "many" -- "1" Book : references >

GiftList "1" -- "many" GiftPurchase : has >
GiftPurchase "many" -- "1" User : buyer >
GiftPurchase "many" -- "1" Book : item >

User "1" -- "many" Review : writes >
Review "many" -- "1" Book : reviews >

User "1" -- "many" Comment : posts >
Comment "many" -- "1" Book : comments >

User "1" -- "many" UserEbook : owns >
UserEbook "many" -- "1" Book : represents >

Order "1" -- "many" GiftRedemption : generates >
GiftRedemption "many" -- "1" Book : gift >
GiftRedemption "many" -- "0..1" User : redeemed_by >

Category "1" -- "many" Book : classifies >

@enduml
